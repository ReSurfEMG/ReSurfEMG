<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>resurfemg.postprocessing.event_detection module &#8212; resurfemg 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css?v=0f882399" />
    <script src="_static/documentation_options.js?v=8d563738"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="resurfemg.postprocessing.features module" href="resurfemg.postprocessing.features.html" />
    <link rel="prev" title="resurfemg.postprocessing.baseline module" href="resurfemg.postprocessing.baseline.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="resurfemg.postprocessing.features.html" title="resurfemg.postprocessing.features module"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="resurfemg.postprocessing.baseline.html" title="resurfemg.postprocessing.baseline module"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">resurfemg 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="modules.html" >resurfemg</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="resurfemg.html" >resurfemg package</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="resurfemg.postprocessing.html" accesskey="U">resurfemg.postprocessing package</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">resurfemg.postprocessing.event_detection module</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="module-resurfemg.postprocessing.event_detection">
<span id="resurfemg-postprocessing-event-detection-module"></span><h1>resurfemg.postprocessing.event_detection module<a class="headerlink" href="#module-resurfemg.postprocessing.event_detection" title="Link to this heading">¶</a></h1>
<p>Copyright 2022 Netherlands eScience Center and University of Twente
Licensed under the Apache License, version 2.0. See LICENSE for details.</p>
<p>This file contains functions to extract detect peak, on- and offset samples.</p>
<dl class="py function">
<dt class="sig sig-object py" id="resurfemg.postprocessing.event_detection.detect_emg_breaths">
<span class="sig-prename descclassname"><span class="pre">resurfemg.postprocessing.event_detection.</span></span><span class="sig-name descname"><span class="pre">detect_emg_breaths</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">emg_env</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">emg_baseline</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prominence_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_peak_width_s</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#resurfemg.postprocessing.event_detection.detect_emg_breaths" title="Link to this definition">¶</a></dt>
<dd><p>Identify the electrophysiological breaths from the EMG envelope and return
an array breath peak indices. Input of baseline threshold, peak prominence
factor, and minimal peak width are optional.
—————————————————————————
:param emg_env: 1D EMG envelope signal
:type emg_env: ~numpy.ndarray
:param emg_baseline: EMG baseline. If none provided, 0 baseline is used.
:type emg_baseline: ~numpy.ndarray
:param threshold: required threshold of peaks, vertical threshold to
neighbouring samples
:type threshold: ~float
:param prominence_factor: required prominence of peaks, relative to the
75th - 50th percentile of the emg_env above the baseline
:type prominence_factor: ~float
:param min_peak_width_s: required width of peak in samples
:type min_peak_width_s: ~int</p>
<dl class="field-list simple">
<dt class="field-odd">Returns peak_idxs<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of EMG breath peak indices</p>
</dd>
<dt class="field-even">Rtype peak_idxs<span class="colon">:</span></dt>
<dd class="field-even"><p>list[int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="resurfemg.postprocessing.event_detection.detect_ventilator_breath">
<span class="sig-prename descclassname"><span class="pre">resurfemg.postprocessing.event_detection.</span></span><span class="sig-name descname"><span class="pre">detect_ventilator_breath</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">v_vent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width_s</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prominence</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold_new</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prominence_new</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#resurfemg.postprocessing.event_detection.detect_ventilator_breath" title="Link to this definition">¶</a></dt>
<dd><p>Identify the breaths from the ventilator signal and return an array
of ventilator peak breath indices, in two steps of peak detection.
Input of threshold and prominence values is optional.
—————————————————————————
:param v_vent: Ventilator volume signal
:type v_vent: ~numpy.ndarray
:param start_idx: start sample of the window in which to be searched
:type start_idx: ~int
:param end_idx: end sample of the window in which to be searched
:type end_idx: ~int
:param width_s: required width of peak in samples
:type width_s:
:param threshold: required threshold of peaks, vertical threshold to
neighbouring samples
:type threshold: ~int
:param prominence: required prominence of peaks
:type prominence: ~int
:param threshold_new:
:type threshold_new: ~int
:param prominence_new:
:type prominence_new: ~int</p>
<dl class="field-list simple">
<dt class="field-odd">Returns ventilator_breath_idxs<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of ventilator breath peak indices</p>
</dd>
<dt class="field-even">Rtype ventilator_breath_idxs<span class="colon">:</span></dt>
<dd class="field-even"><p>list[int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="resurfemg.postprocessing.event_detection.find_linked_peaks">
<span class="sig-prename descclassname"><span class="pre">resurfemg.postprocessing.event_detection.</span></span><span class="sig-name descname"><span class="pre">find_linked_peaks</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signal_1_t_peaks</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">signal_2_t_peaks</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#resurfemg.postprocessing.event_detection.find_linked_peaks" title="Link to this definition">¶</a></dt>
<dd><p>Find the indices of the peaks in signal 2 closest to the time of the
peaks in signal 1
:param signal_1_t_peaks: list of timing of peaks in signal 1
:type signal_1_t_peaks: ~numpy.ndarray
:param signal_2_t_peaks: list of timing of peaks in signal 2
:type signal_2_t_peaks: ~numpy.ndarray</p>
<dl class="field-list simple">
<dt class="field-odd">Returns peaks_idxs_signal_1_in_2<span class="colon">:</span></dt>
<dd class="field-odd"><p>Peak indices of signal 2 closest to the
peaks in signal 1</p>
</dd>
<dt class="field-even">Rtype peaks_idxs_signal_1_in_2<span class="colon">:</span></dt>
<dd class="field-even"><p>~numpy.ndarray[int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="resurfemg.postprocessing.event_detection.find_occluded_breaths">
<span class="sig-prename descclassname"><span class="pre">resurfemg.postprocessing.event_detection.</span></span><span class="sig-name descname"><span class="pre">find_occluded_breaths</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">p_vent</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peep</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">start_idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">end_idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">prominence_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.8</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_width_s</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance_s</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#resurfemg.postprocessing.event_detection.find_occluded_breaths" title="Link to this definition">¶</a></dt>
<dd><p>Find end-expiratory occlusion manoeuvres (Pocc) in ventilator pressure
timeseries data. start_idx and end_idx specify the samples to look into.
The prominence_factor, min_width_s, and distance_s specify the minimal
peak prominence relative to the PEEP level, peak width in samples, and
distance to other peaks.
—————————————————————————
:param p_vent: ventilator pressure signal
:type p_vent: ~nd.array
:param fs: sampling rate
:type fs: int
:param peep: positive end-expiratory pressure
:type peep: ~float
:param start_idx: start index to start looking for Pocc manoeuvres
:type start_idx: int
:param end_idx: end index to start looking for Pocc manoeuvres
:type end_idx: int
:param prominence_factor: multiplier in setting the minimum peak prominence
:type prominence_factor: ~float
:param min_width_s: minimum peak width in samples
:type min_width_s: int
:param distance_s: mininum interpeak distance in samples
:type distance_s: int</p>
<dl class="field-list simple">
<dt class="field-odd">Returns peak_idxs<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of Pocc peak indices</p>
</dd>
<dt class="field-even">Rtpe peak_idxs<span class="colon">:</span></dt>
<dd class="field-even"><p>~nd.array[int]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="resurfemg.postprocessing.event_detection.onoffpeak_baseline_crossing">
<span class="sig-prename descclassname"><span class="pre">resurfemg.postprocessing.event_detection.</span></span><span class="sig-name descname"><span class="pre">onoffpeak_baseline_crossing</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signal_env</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">baseline</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peak_idxs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#resurfemg.postprocessing.event_detection.onoffpeak_baseline_crossing" title="Link to this definition">¶</a></dt>
<dd><p>This function calculates the peaks of each breath using the
slopesum baseline of envelope data.
—————————————————————————
:param signal_env: envelope signal
:type signal_env: ~numpy.ndarray
:param baseline: baseline signal of EMG data for baseline detection
:type baseline: ~numpy.ndarray
:param peak_idxs: list of peak indices for which to find on- and offset
:type peak_idxs: ~numpy.ndarray</p>
<dl class="field-list simple">
<dt class="field-odd">Returns peak_start_idxs<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of start indices of the peaks</p>
</dd>
<dt class="field-even">Rtype peak_start_idxs<span class="colon">:</span></dt>
<dd class="field-even"><p>~numpy.ndarray[int]</p>
</dd>
<dt class="field-odd">Returns peak_end_idxs<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of end indices of the peaks</p>
</dd>
<dt class="field-even">Rtype peak_end_idxs<span class="colon">:</span></dt>
<dd class="field-even"><p>~numpy.ndarray[int]</p>
</dd>
<dt class="field-odd">Returns valid_starts_bools<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of boolean values for valid starts</p>
</dd>
<dt class="field-even">Rtype valid_starts_bools<span class="colon">:</span></dt>
<dd class="field-even"><p>~numpy.ndarray[bool]</p>
</dd>
<dt class="field-odd">Returns valid_ends_bools<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of boolean values for valid ends</p>
</dd>
<dt class="field-even">Rtype valid_ends_bools<span class="colon">:</span></dt>
<dd class="field-even"><p>~numpy.ndarray[bool]</p>
</dd>
<dt class="field-odd">Returns valid_peaks<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of boolean values for valid peaks</p>
</dd>
<dt class="field-even">Rtype valid_peaks<span class="colon">:</span></dt>
<dd class="field-even"><p>~numpy.ndarray[bool]</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="resurfemg.postprocessing.event_detection.onoffpeak_slope_extrapolation">
<span class="sig-prename descclassname"><span class="pre">resurfemg.postprocessing.event_detection.</span></span><span class="sig-name descname"><span class="pre">onoffpeak_slope_extrapolation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">signal_env</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">fs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">peak_idxs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slope_window_s</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#resurfemg.postprocessing.event_detection.onoffpeak_slope_extrapolation" title="Link to this definition">¶</a></dt>
<dd><p>This function calculates the peak on- and offsets of a signal by extra-
polating the maximum slopes in de slope_window_s to the zero crossings.
The validity arrays provide feedback on the validity of the detected on-
and offsets, aiming to prevent onsets after peak indices, offsets before
peak indices, and overlapping peaks.
—————————————————————————
:param signal_env: signal to identify on- and offsets in
:type signal_env: ~numpy.ndarray
:param fs: sampling rate
:type fs: int
:param peak_idxs: list of peak indices for which to find on- and offset
:type peak_idxs: ~numpy.ndarray
:slope_window_s: how many samples on each side to use for the comparison
to consider for detecting the local maximum slope
:type fs: int</p>
<dl class="field-list simple">
<dt class="field-odd">Returns peak_start_idxs<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of start indices of the peaks</p>
</dd>
<dt class="field-even">Rtype peak_start_idxs<span class="colon">:</span></dt>
<dd class="field-even"><p>~numpy.ndarray[int]</p>
</dd>
<dt class="field-odd">Returns peak_end_idxs<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of end indices of the peaks</p>
</dd>
<dt class="field-even">Rtype peak_end_idxs<span class="colon">:</span></dt>
<dd class="field-even"><p>~numpy.ndarray[int]</p>
</dd>
<dt class="field-odd">Returns valid_starts_bools<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of boolean values for valid starts</p>
</dd>
<dt class="field-even">Rtype valid_starts_bools<span class="colon">:</span></dt>
<dd class="field-even"><p>~numpy.ndarray[bool]</p>
</dd>
<dt class="field-odd">Returns valid_ends_bools<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of boolean values for valid ends</p>
</dd>
<dt class="field-even">Rtype valid_ends_bools<span class="colon">:</span></dt>
<dd class="field-even"><p>~numpy.ndarray[bool]</p>
</dd>
<dt class="field-odd">Returns valid_peaks<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of boolean values for valid peaks</p>
</dd>
<dt class="field-even">Rtype valid_peaks<span class="colon">:</span></dt>
<dd class="field-even"><p>~numpy.ndarray[bool]</p>
</dd>
</dl>
</dd></dl>

</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">resurfemg.postprocessing.event_detection module</a><ul>
<li><a class="reference internal" href="#resurfemg.postprocessing.event_detection.detect_emg_breaths"><code class="docutils literal notranslate"><span class="pre">detect_emg_breaths()</span></code></a></li>
<li><a class="reference internal" href="#resurfemg.postprocessing.event_detection.detect_ventilator_breath"><code class="docutils literal notranslate"><span class="pre">detect_ventilator_breath()</span></code></a></li>
<li><a class="reference internal" href="#resurfemg.postprocessing.event_detection.find_linked_peaks"><code class="docutils literal notranslate"><span class="pre">find_linked_peaks()</span></code></a></li>
<li><a class="reference internal" href="#resurfemg.postprocessing.event_detection.find_occluded_breaths"><code class="docutils literal notranslate"><span class="pre">find_occluded_breaths()</span></code></a></li>
<li><a class="reference internal" href="#resurfemg.postprocessing.event_detection.onoffpeak_baseline_crossing"><code class="docutils literal notranslate"><span class="pre">onoffpeak_baseline_crossing()</span></code></a></li>
<li><a class="reference internal" href="#resurfemg.postprocessing.event_detection.onoffpeak_slope_extrapolation"><code class="docutils literal notranslate"><span class="pre">onoffpeak_slope_extrapolation()</span></code></a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="resurfemg.postprocessing.baseline.html"
                          title="previous chapter">resurfemg.postprocessing.baseline module</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="resurfemg.postprocessing.features.html"
                          title="next chapter">resurfemg.postprocessing.features module</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/resurfemg.postprocessing.event_detection.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="Related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="resurfemg.postprocessing.features.html" title="resurfemg.postprocessing.features module"
             >next</a> |</li>
        <li class="right" >
          <a href="resurfemg.postprocessing.baseline.html" title="resurfemg.postprocessing.baseline module"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">resurfemg 1.0.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="modules.html" >resurfemg</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="resurfemg.html" >resurfemg package</a> &#187;</li>
          <li class="nav-item nav-item-3"><a href="resurfemg.postprocessing.html" >resurfemg.postprocessing package</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">resurfemg.postprocessing.event_detection module</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2022, e.oppersma@utwente.nl.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    </div>
  </body>
</html>